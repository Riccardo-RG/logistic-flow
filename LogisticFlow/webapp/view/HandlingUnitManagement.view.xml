<mvc:View controllerName="logistic-flow.controller.HandlingUnitManagement"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core">

    <!-- Pagina principale -->
    <Page title="Saisie de collisage" showNavButton="true" navButtonPress="onNavBack" class="bpPreparationPage">
        <content>
            <!-- Pannello con Tabella e Pulsanti -->
            <Panel class="bpPanel">
                <ScrollContainer width="100%" horizontal="true" vertical="false">
                    <Table id="idHandlingUnitTable" width="900px" growing="true" growingScrollToLoad="true" sticky="ColumnHeaders" items="{modelName>/Produits}">

                        <headerToolbar>
                            <Toolbar>
                                <Title text="Saisie" level="H2"/>
                                <ToolbarSpacer/>
                                <Button text="Actualiser" press="onRefresh" icon="sap-icon://refresh"/>
                            </Toolbar>
                        </headerToolbar>

                        <columns>
                            <Column>
                                <Text text="Produit"/>
                            </Column>
                            <Column>
                                <Text text="Palette"/>
                            </Column>
                            <Column>
                                <Text text="Box"/>
                            </Column>
                            <Column>
                                <Text text="Nombre"/>
                            </Column>
                            <Column>
                                <Text text="Condi"/>
                            </Column>
                            <Column>
                                <Text text="Qtè"/>
                            </Column>
                        </columns>

                        <items>
                            <ColumnListItem>
                                <cells>
                                    <!-- Colonna Prodotto -->
                                    <Text text="{modelName>Produit}" />

                                    <!-- Colonna Palette (condizionale) -->
                                    <HBox>
                                        <Text text="{modelName>DisplayPalette}" visible="{modelName>PaletteVisible}"/>
                                        <Button icon="sap-icon://add" press="onOpenSelectionDialog" visible="{modelName>PaletteButtonVisible}">
                                            <customData>
                                                <core:CustomData key="property" value="Palette"/>
                                            </customData>
                                        </Button>
                                    </HBox>

                                    <!-- Colonna Box (condizionale) -->
                                    <HBox>
                                        <Text text="{modelName>Box}" visible="{modelName>BoxVisible}"/>
                                        <Button icon="sap-icon://add" press="onOpenSelectionDialog" visible="{modelName>BoxButtonVisible}">
                                            <customData>
                                                <core:CustomData key="property" value="Box"/>
                                            </customData>
                                        </Button>
                                    </HBox>

                                    <Text text="{modelName>Nombre}" />
                                    <Text text="{modelName>Condi}" />
                                    <Text text="{modelName>Qte}" />
                                </cells>
                            </ColumnListItem>
                        </items>
                    </Table>
                </ScrollContainer>

                <!-- Pulsanti di gestione -->
                <VBox alignItems="Center" class="deleteButtonContainer sapUiSmallMarginTop">
                    <Button id="idManagePalletteButton" text="Manage Palette" press="onOpenManagePalletteDialog" icon="sap-icon://settings" type="Default"/>
                    <Button text="Supprimer ligne" press="onDeleteRow" icon="sap-icon://delete" type="Negative"/>
                    <Button text="Send Delivery" press="onSendDelivery" icon="sap-icon://upload" type="Emphasized"/>
                </VBox>
            </Panel>
        </content>
    </Page>

    <!-- Dialog per la selezione di Palette e Box (aperto cliccando sulle icone "+") -->
    <Dialog id="idSelectBoxPalletDialog" title="Sélection pour le produit F" afterClose="onCloseSelectionDialog">
        <content>
            <HBox justifyContent="SpaceAround" width="100%">
                <!-- Colonna Pallets -->
                <VBox width="45%">
                    <Title text="Palette" level="H3"/>
                    <List id="idPalletList" mode="SingleSelectMaster" items="{modelName>/Pallets}" selectionChange="onSelectPallet">
                        <StandardListItem title="{modelName>Name}" />
                    </List>
                </VBox>

                <!-- Colonna Boxes -->
                <VBox width="45%">
                    <Title text="Box" level="H3"/>
                    <List id="idBoxList" mode="SingleSelectMaster" items="{modelName>/Boxes}" selectionChange="onSelectBox">
                        <StandardListItem title="{modelName>Name}" />
                    </List>
                </VBox>
            </HBox>
        </content>
        <beginButton>
            <Button text="OK" press="onConfirmSelection"/>
        </beginButton>
        <endButton>
            <Button text="Annuler" press="onCloseSelectionDialog"/>
        </endButton>
    </Dialog>

    <!-- Dialog per la gestione delle Palette (aperto con il bottone "Manage Palette") -->
    <Dialog id="idManagePalletteDialog" title="Sélectionnez les palettes. " class="customDialog" afterClose="onCloseManagePalletteDialog">
        <content>
            <VBox>
                <List id="idAllPalletsList" mode="None" items="{modelName>/AllPalettes}">
                    <CustomListItem>
                        <HBox justifyContent="SpaceBetween" alignItems="Center">
                            <!-- Mappatura dell'array AllPalettes per mostrare il Name -->
                            <Text text="{modelName>Name}" class="sapUiSmallMargin"/>
                            <HBox>
                                <Button icon="sap-icon://less" press="onDecreasePallette"/>
                                <Text text="{modelName>SelectedQuantity}" class="sapUiSmallMargin"/>
                                <Button icon="sap-icon://add" press="onIncreasePallette"/>
                            </HBox>
                        </HBox>
                    </CustomListItem>
                </List>
            </VBox>
        </content>
        <beginButton>
            <Button text="OK" press="onConfirmManagePallette"/>
        </beginButton>
        <endButton>
            <Button text="Annuler" press="onCloseManagePalletteDialog"/>
        </endButton>
    </Dialog>

</mvc:View>